<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>📌 SOA Task Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{GA4_MEASUREMENT_ID}}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
  </script>

  <style>
    :root {
      --primary: #007BFF;
      --bg: #ffffff;
      --text: #222;
      --card-bg: #ffffff;
      --border: #ddd;
      --header-bg: #e9ecef;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }
    #lastUpdated {
  	font-size: 1rem;
  	margin-bottom: 1rem;
  	display: none;
    }
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .filter-group {
      flex: 1 1 200px;
      min-width: 140px;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 0.25rem;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 5px;
      width: 100%;
    }
    @media screen and (max-width: 600px) {
      .filters {
        flex-direction: column;
        gap: 0.75rem;
      }
      .filter-group {
        flex: 1 1 100%;
      }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background-color: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    th, td {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: var(--header-bg);
      font-weight: bold;
    }
    td.comments {
      white-space: pre-wrap;
    }
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }
      tr {
        margin-bottom: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);
      }
      td {
        display: block;
        padding: 0.6rem 0;
        border-bottom: 1px solid var(--border);
        word-wrap: break-word;
      }
      td::before {
        content: attr(data-label);
        display: block;
        font-weight: bold;
        color: #555;
        margin-bottom: 0.25rem;
      }
      td:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>

<h1>📌 SOA Task Tracker</h1>
<p id="lastUpdated">
  <strong style="color: var(--primary);">Last Updated:</strong> 
  <span style="font-weight:600; color:#333;"></span>
</p>


<div id="filters" class="filters" style="display:none;">
  <div class="filter-group">
    <label for="priorityFilter">Priority</label>
    <select id="priorityFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="ownerFilter">Ownership</label>
    <select id="ownerFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="statusFilter">Status</label>
    <select id="statusFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
</div>

<table id="taskTable" style="display:none;">
  <thead>
    <tr>
      <th>Task</th>
      <th>Priority</th>
      <th>Ownership</th>
      <th>Status</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const encrypted = {
    salt: "H0ylXuoALu7Rz/86k5WUkg==",
    iv: "fbxjAVGDcGGIDUnI",
    ciphertext: "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",
    iterations: 200000
  };
  const correctHashHex = "289f8caa3b9d1be0c450d26b040c1280fb1e72492f93ea764d47b2351b2cc9bf";

  function b64ToArr(b64){ return Uint8Array.from(atob(b64), c => c.charCodeAt(0)); }
  function arrToStr(buf){ return new TextDecoder().decode(buf); }

  async function hashPassword(password){
    const enc = new TextEncoder().encode(password);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function deriveKey(password, salt_b64, iterations){
    const salt = b64ToArr(salt_b64);
    const pwUtf8 = new TextEncoder().encode(password);
    const baseKey = await crypto.subtle.importKey('raw', pwUtf8, {name:'PBKDF2'}, false, ['deriveKey']);
    return crypto.subtle.deriveKey(
      { name: 'PBKDF2', salt: salt, iterations: iterations, hash: 'SHA-256' },
      baseKey,
      { name: 'AES-GCM', length: 256 },
      false,
      ['decrypt']
    );
  }

  async function decryptData(password){
    const key = await deriveKey(password, encrypted.salt, encrypted.iterations);
    const iv = b64ToArr(encrypted.iv);
    const ct = b64ToArr(encrypted.ciphertext);
    const plain = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: iv }, key, ct);
    return arrToStr(plain);
  }

  async function loadTasks(){
    const password = prompt("Enter password:");
    if(!password) return;

    const hashHex = await hashPassword(password);
    if(hashHex !== correctHashHex){
      alert("❌ Incorrect password");
      return;
    }

    try {
      const decrypted = await decryptData(password);
      const data = JSON.parse(decrypted);

      // ✅ Show last updated
      document.getElementById("lastUpdated").style.display = "block";
      document.querySelector("#lastUpdated span").textContent = data.lastUpdated || "N/A";

      renderTasks(data.tasks);

      gtag('config', '{{GA4_MEASUREMENT_ID}}', {
        page_path: '/secure-tasks',
        page_title: 'Secure Task List'
      });

    } catch {
      alert("❌ Failed to decrypt tasks");
    }
  }

  function renderTasks(tasks){
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";
    const priorities = new Set();
    const owners = new Set();
    const statuses = new Set();

    tasks.forEach(task => {
      priorities.add(task.priority);
      owners.add(task.owner);
      statuses.add(task.status);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Task">${task.task}</td>
        <td data-label="Priority">${task.priority}</td>
        <td data-label="Ownership">${task.owner}</td>
        <td data-label="Status">${task.status}</td>
        <td class="comments" data-label="Comments">${task.comments}</td>
      `;
      tbody.appendChild(tr);
    });

    const prioritySelect = document.getElementById("priorityFilter");
    const ownerSelect = document.getElementById("ownerFilter");
    const statusSelect = document.getElementById("statusFilter");

    priorities.forEach(p => {
      prioritySelect.innerHTML += `<option value="${p}">${p}</option>`;
    });
    owners.forEach(o => {
      ownerSelect.innerHTML += `<option value="${o}">${o}</option>`;
    });
    statuses.forEach(s => {
      statusSelect.innerHTML += `<option value="${s}">${s}</option>`;
    });

    document.getElementById("filters").style.display = "flex";
    document.getElementById("taskTable").style.display = "table";
  }

  function filterTable(){
    const priorityVal = document.getElementById("priorityFilter").value.toLowerCase();
    const ownerVal = document.getElementById("ownerFilter").value.toLowerCase();
    const statusVal = document.getElementById("statusFilter").value.toLowerCase();

    document.querySelectorAll("#taskTable tbody tr").forEach(row => {
      const p = row.cells[1].textContent.toLowerCase();
      const o = row.cells[2].textContent.toLowerCase();
      const s = row.cells[3].textContent.toLowerCase();
      row.style.display = 
        (priorityVal === "all" || p === priorityVal) &&
        (ownerVal === "all" || o === ownerVal) &&
        (statusVal === "all" || s === statusVal)
        ? "" : "none";
    });
  }

  loadTasks();
</script>

</body>
</html>

