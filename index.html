<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìù SOA Task Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{GA4_MEASUREMENT_ID}}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
  </script>

  <style>
    :root {
      --primary: #007BFF;
      --bg: #ffffff;
      --text: #222;
      --card-bg: #ffffff;
      --border: #ddd;
      --header-bg: #e9ecef;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }
    #lastUpdated {
  	font-size: 1rem;
  	margin-bottom: 1rem;
  	display: none;
    }
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .filter-group {
      flex: 1 1 200px;
      min-width: 140px;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 0.25rem;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 5px;
      width: 100%;
    }
    @media screen and (max-width: 600px) {
      .filters {
        flex-direction: column;
        gap: 0.75rem;
      }
      .filter-group {
        flex: 1 1 100%;
      }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background-color: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    th, td {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: var(--header-bg);
      font-weight: bold;
    }
    td.comments {
      white-space: pre-wrap;
    }
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }
      tr {
        margin-bottom: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);
      }
      td {
        display: block;
        padding: 0.6rem 0;
        border-bottom: 1px solid var(--border);
        word-wrap: break-word;
      }
      td::before {
        content: attr(data-label);
        display: block;
        font-weight: bold;
        color: #555;
        margin-bottom: 0.25rem;
      }
      td:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>

<h1>üìù SOA Task Tracker</h1>
<p id="lastUpdated">
  <strong style="color: var(--primary);">Last Updated:</strong> 
  <span style="font-weight:600; color:#333;"></span>
</p>


<div id="filters" class="filters" style="display:none;">
  <div class="filter-group">
    <label for="priorityFilter">Priority</label>
    <select id="priorityFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="ownerFilter">Ownership</label>
    <select id="ownerFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="statusFilter">Status</label>
    <select id="statusFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
</div>

<table id="taskTable" style="display:none;">
  <thead>
    <tr>
      <th>Task</th>
      <th>Priority</th>
      <th>Ownership</th>
      <th>Status</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const encrypted = {
    salt: "kV495jNmpbYP8PBBvd2KTg==",
    iv: "1wiqqaWEGZhNK+NH",
    ciphertext: "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",
    iterations: 200000
  };
  const correctHashHex = "289f8caa3b9d1be0c450d26b040c1280fb1e72492f93ea764d47b2351b2cc9bf";

  function b64ToArr(b64){ return Uint8Array.from(atob(b64), c => c.charCodeAt(0)); }
  function arrToStr(buf){ return new TextDecoder().decode(buf); }

  async function hashPassword(password){
    const enc = new TextEncoder().encode(password);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function deriveKey(password, salt_b64, iterations){
    const salt = b64ToArr(salt_b64);
    const pwUtf8 = new TextEncoder().encode(password);
    const baseKey = await crypto.subtle.importKey('raw', pwUtf8, {name:'PBKDF2'}, false, ['deriveKey']);
    return crypto.subtle.deriveKey(
      { name: 'PBKDF2', salt: salt, iterations: iterations, hash: 'SHA-256' },
      baseKey,
      { name: 'AES-GCM', length: 256 },
      false,
      ['decrypt']
    );
  }

  async function decryptData(password){
    const key = await deriveKey(password, encrypted.salt, encrypted.iterations);
    const iv = b64ToArr(encrypted.iv);
    const ct = b64ToArr(encrypted.ciphertext);
    const plain = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: iv }, key, ct);
    return arrToStr(plain);
  }

  async function loadTasks(){
    const password = prompt("Enter password:");
    if(!password) return;

    const hashHex = await hashPassword(password);
    if(hashHex !== correctHashHex){
      alert("‚ùå Incorrect password");
      return;
    }

    try {
      const decrypted = await decryptData(password);
      const data = JSON.parse(decrypted);

      // ‚úÖ Show last updated
      document.getElementById("lastUpdated").style.display = "block";
      document.querySelector("#lastUpdated span").textContent = data.lastUpdated || "N/A";

      renderTasks(data.tasks);

      gtag('config', '{{GA4_MEASUREMENT_ID}}', {
        page_path: '/secure-tasks',
        page_title: 'Secure Task List'
      });

    } catch {
      alert("‚ùå Failed to decrypt tasks");
    }
  }

  function renderTasks(tasks){
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";
    const priorities = new Set();
    const owners = new Set();
    const statuses = new Set();

    tasks.forEach(task => {
      priorities.add(task.priority);
      owners.add(task.owner);
      statuses.add(task.status);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Task">${task.task}</td>
        <td data-label="Priority">${task.priority}</td>
        <td data-label="Ownership">${task.owner}</td>
        <td data-label="Status">${task.status}</td>
        <td class="comments" data-label="Comments">${task.comments}</td>
      `;
      tbody.appendChild(tr);
    });

    const prioritySelect = document.getElementById("priorityFilter");
    const ownerSelect = document.getElementById("ownerFilter");
    const statusSelect = document.getElementById("statusFilter");

    priorities.forEach(p => {
      prioritySelect.innerHTML += `<option value="${p}">${p}</option>`;
    });
    owners.forEach(o => {
      ownerSelect.innerHTML += `<option value="${o}">${o}</option>`;
    });
    statuses.forEach(s => {
      statusSelect.innerHTML += `<option value="${s}">${s}</option>`;
    });

    document.getElementById("filters").style.display = "flex";
    document.getElementById("taskTable").style.display = "table";
  }

  function filterTable(){
    const priorityVal = document.getElementById("priorityFilter").value.toLowerCase();
    const ownerVal = document.getElementById("ownerFilter").value.toLowerCase();
    const statusVal = document.getElementById("statusFilter").value.toLowerCase();

    document.querySelectorAll("#taskTable tbody tr").forEach(row => {
      const p = row.cells[1].textContent.toLowerCase();
      const o = row.cells[2].textContent.toLowerCase();
      const s = row.cells[3].textContent.toLowerCase();
      row.style.display = 
        (priorityVal === "all" || p === priorityVal) &&
        (ownerVal === "all" || o === ownerVal) &&
        (statusVal === "all" || s === statusVal)
        ? "" : "none";
    });
  }

  loadTasks();
</script>

</body>
</html>

