<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìù SOA Task Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{GA4_MEASUREMENT_ID}}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
  </script>

  <style>
    :root {
      --primary: #007BFF;
      --bg: #ffffff;
      --text: #222;
      --card-bg: #ffffff;
      --border: #ddd;
      --header-bg: #e9ecef;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }
    #lastUpdated {
  	font-size: 1rem;
  	margin-bottom: 1rem;
  	display: none;
    }
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .filter-group {
      flex: 1 1 200px;
      min-width: 140px;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 0.25rem;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 5px;
      width: 100%;
    }
    @media screen and (max-width: 600px) {
      .filters {
        flex-direction: column;
        gap: 0.75rem;
      }
      .filter-group {
        flex: 1 1 100%;
      }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background-color: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    th, td {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: var(--header-bg);
      font-weight: bold;
    }
    td.comments {
      white-space: pre-wrap;
    }
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }
      tr {
        margin-bottom: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);
      }
      td {
        display: block;
        padding: 0.6rem 0;
        border-bottom: 1px solid var(--border);
        word-wrap: break-word;
      }
      td::before {
        content: attr(data-label);
        display: block;
        font-weight: bold;
        color: #555;
        margin-bottom: 0.25rem;
      }
      td:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>

<h1>üìù SOA Task Tracker</h1>
<p id="lastUpdated">
  <strong style="color: var(--primary);">Last Updated:</strong> 
  <span style="font-weight:600; color:#333;"></span>
</p>


<div id="filters" class="filters" style="display:none;">
  <div class="filter-group">
    <label for="priorityFilter">Priority</label>
    <select id="priorityFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="ownerFilter">Ownership</label>
    <select id="ownerFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="statusFilter">Status</label>
    <select id="statusFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
</div>

<table id="taskTable" style="display:none;">
  <thead>
    <tr>
      <th>Task</th>
      <th>Priority</th>
      <th>Ownership</th>
      <th>Status</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const encrypted = {
    salt: "VlQON2akSxBCjcTWLB4oXw==",
    iv: "XztkHIJccbvScaMB",
    ciphertext: "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",
    iterations: 200000
  };
  const correctHashHex = "289f8caa3b9d1be0c450d26b040c1280fb1e72492f93ea764d47b2351b2cc9bf";

  function b64ToArr(b64){ return Uint8Array.from(atob(b64), c => c.charCodeAt(0)); }
  function arrToStr(buf){ return new TextDecoder().decode(buf); }

  async function hashPassword(password){
    const enc = new TextEncoder().encode(password);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function deriveKey(password, salt_b64, iterations){
    const salt = b64ToArr(salt_b64);
    const pwUtf8 = new TextEncoder().encode(password);
    const baseKey = await crypto.subtle.importKey('raw', pwUtf8, {name:'PBKDF2'}, false, ['deriveKey']);
    return crypto.subtle.deriveKey(
      { name: 'PBKDF2', salt: salt, iterations: iterations, hash: 'SHA-256' },
      baseKey,
      { name: 'AES-GCM', length: 256 },
      false,
      ['decrypt']
    );
  }

  async function decryptData(password){
    const key = await deriveKey(password, encrypted.salt, encrypted.iterations);
    const iv = b64ToArr(encrypted.iv);
    const ct = b64ToArr(encrypted.ciphertext);
    const plain = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: iv }, key, ct);
    return arrToStr(plain);
  }

  async function loadTasks(){
    const password = prompt("Enter password:");
    if(!password) return;

    const hashHex = await hashPassword(password);
    if(hashHex !== correctHashHex){
      alert("‚ùå Incorrect password");
      return;
    }

    try {
      const decrypted = await decryptData(password);
      const data = JSON.parse(decrypted);

      // ‚úÖ Show last updated
      document.getElementById("lastUpdated").style.display = "block";
      document.querySelector("#lastUpdated span").textContent = data.lastUpdated || "N/A";

      renderTasks(data.tasks);

      gtag('config', '{{GA4_MEASUREMENT_ID}}', {
        page_path: '/secure-tasks',
        page_title: 'Secure Task List'
      });

    } catch {
      alert("‚ùå Failed to decrypt tasks");
    }
  }

  function renderTasks(tasks){
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";
    const priorities = new Set();
    const owners = new Set();
    const statuses = new Set();

    tasks.forEach(task => {
      priorities.add(task.priority);
      owners.add(task.owner);
      statuses.add(task.status);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Task">${task.task}</td>
        <td data-label="Priority">${task.priority}</td>
        <td data-label="Ownership">${task.owner}</td>
        <td data-label="Status">${task.status}</td>
        <td class="comments" data-label="Comments">${task.comments}</td>
      `;
      tbody.appendChild(tr);
    });

    const prioritySelect = document.getElementById("priorityFilter");
    const ownerSelect = document.getElementById("ownerFilter");
    const statusSelect = document.getElementById("statusFilter");

    priorities.forEach(p => {
      prioritySelect.innerHTML += `<option value="${p}">${p}</option>`;
    });
    owners.forEach(o => {
      ownerSelect.innerHTML += `<option value="${o}">${o}</option>`;
    });
    statuses.forEach(s => {
      statusSelect.innerHTML += `<option value="${s}">${s}</option>`;
    });

    document.getElementById("filters").style.display = "flex";
    document.getElementById("taskTable").style.display = "table";
  }

  function filterTable(){
    const priorityVal = document.getElementById("priorityFilter").value.toLowerCase();
    const ownerVal = document.getElementById("ownerFilter").value.toLowerCase();
    const statusVal = document.getElementById("statusFilter").value.toLowerCase();

    document.querySelectorAll("#taskTable tbody tr").forEach(row => {
      const p = row.cells[1].textContent.toLowerCase();
      const o = row.cells[2].textContent.toLowerCase();
      const s = row.cells[3].textContent.toLowerCase();
      row.style.display = 
        (priorityVal === "all" || p === priorityVal) &&
        (ownerVal === "all" || o === ownerVal) &&
        (statusVal === "all" || s === statusVal)
        ? "" : "none";
    });
  }

  loadTasks();
</script>

</body>
</html>

