<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìù SOA Task Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{GA4_MEASUREMENT_ID}}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
  </script>

  <style>
    :root {
      --primary: #007BFF;
      --bg: #ffffff;
      --text: #222;
      --card-bg: #ffffff;
      --border: #ddd;
      --header-bg: #e9ecef;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: var(--primary);
    }
    #lastUpdated {
  	font-size: 1rem;
  	margin-bottom: 1rem;
  	display: none;
    }
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .filter-group {
      flex: 1 1 200px;
      min-width: 140px;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 0.25rem;
    }
    select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 5px;
      width: 100%;
    }
    @media screen and (max-width: 600px) {
      .filters {
        flex-direction: column;
        gap: 0.75rem;
      }
      .filter-group {
        flex: 1 1 100%;
      }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background-color: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    th, td {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: var(--header-bg);
      font-weight: bold;
    }
    td.comments {
      white-space: pre-wrap;
    }
    @media screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }
      tr {
        margin-bottom: 1rem;
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);
      }
      td {
        display: block;
        padding: 0.6rem 0;
        border-bottom: 1px solid var(--border);
        word-wrap: break-word;
      }
      td::before {
        content: attr(data-label);
        display: block;
        font-weight: bold;
        color: #555;
        margin-bottom: 0.25rem;
      }
      td:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>

<h1>üìù SOA Task Tracker</h1>
<p id="lastUpdated">
  <strong style="color: var(--primary);">Last Updated:</strong> 
  <span style="font-weight:600; color:#333;"></span>
</p>


<div id="filters" class="filters" style="display:none;">
  <div class="filter-group">
    <label for="priorityFilter">Priority</label>
    <select id="priorityFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="ownerFilter">Ownership</label>
    <select id="ownerFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
  <div class="filter-group">
    <label for="statusFilter">Status</label>
    <select id="statusFilter" onchange="filterTable()">
      <option value="all">All</option>
    </select>
  </div>
</div>

<table id="taskTable" style="display:none;">
  <thead>
    <tr>
      <th>Task</th>
      <th>Priority</th>
      <th>Ownership</th>
      <th>Status</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const encrypted = {
    salt: "p5idiGdyAFEJqVoM+F9GyQ==",
    iv: "ZJizxNa414hYkppU",
    ciphertext: "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",
    iterations: 200000
  };
  const correctHashHex = "289f8caa3b9d1be0c450d26b040c1280fb1e72492f93ea764d47b2351b2cc9bf";

  function b64ToArr(b64){ return Uint8Array.from(atob(b64), c => c.charCodeAt(0)); }
  function arrToStr(buf){ return new TextDecoder().decode(buf); }

  async function hashPassword(password){
    const enc = new TextEncoder().encode(password);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function deriveKey(password, salt_b64, iterations){
    const salt = b64ToArr(salt_b64);
    const pwUtf8 = new TextEncoder().encode(password);
    const baseKey = await crypto.subtle.importKey('raw', pwUtf8, {name:'PBKDF2'}, false, ['deriveKey']);
    return crypto.subtle.deriveKey(
      { name: 'PBKDF2', salt: salt, iterations: iterations, hash: 'SHA-256' },
      baseKey,
      { name: 'AES-GCM', length: 256 },
      false,
      ['decrypt']
    );
  }

  async function decryptData(password){
    const key = await deriveKey(password, encrypted.salt, encrypted.iterations);
    const iv = b64ToArr(encrypted.iv);
    const ct = b64ToArr(encrypted.ciphertext);
    const plain = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: iv }, key, ct);
    return arrToStr(plain);
  }

  async function loadTasks(){
    const password = prompt("Enter password:");
    if(!password) return;

    const hashHex = await hashPassword(password);
    if(hashHex !== correctHashHex){
      alert("‚ùå Incorrect password");
      return;
    }

    try {
      const decrypted = await decryptData(password);
      const data = JSON.parse(decrypted);

      // ‚úÖ Show last updated
      document.getElementById("lastUpdated").style.display = "block";
      document.querySelector("#lastUpdated span").textContent = data.lastUpdated || "N/A";

      renderTasks(data.tasks);

      gtag('config', '{{GA4_MEASUREMENT_ID}}', {
        page_path: '/secure-tasks',
        page_title: 'Secure Task List'
      });

    } catch {
      alert("‚ùå Failed to decrypt tasks");
    }
  }

  function renderTasks(tasks){
    const tbody = document.querySelector("#taskTable tbody");
    tbody.innerHTML = "";
    const priorities = new Set();
    const owners = new Set();
    const statuses = new Set();

    tasks.forEach(task => {
      priorities.add(task.priority);
      owners.add(task.owner);
      statuses.add(task.status);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Task">${task.task}</td>
        <td data-label="Priority">${task.priority}</td>
        <td data-label="Ownership">${task.owner}</td>
        <td data-label="Status">${task.status}</td>
        <td class="comments" data-label="Comments">${task.comments}</td>
      `;
      tbody.appendChild(tr);
    });

    const prioritySelect = document.getElementById("priorityFilter");
    const ownerSelect = document.getElementById("ownerFilter");
    const statusSelect = document.getElementById("statusFilter");

    priorities.forEach(p => {
      prioritySelect.innerHTML += `<option value="${p}">${p}</option>`;
    });
    owners.forEach(o => {
      ownerSelect.innerHTML += `<option value="${o}">${o}</option>`;
    });
    statuses.forEach(s => {
      statusSelect.innerHTML += `<option value="${s}">${s}</option>`;
    });

    document.getElementById("filters").style.display = "flex";
    document.getElementById("taskTable").style.display = "table";
  }

  function filterTable(){
    const priorityVal = document.getElementById("priorityFilter").value.toLowerCase();
    const ownerVal = document.getElementById("ownerFilter").value.toLowerCase();
    const statusVal = document.getElementById("statusFilter").value.toLowerCase();

    document.querySelectorAll("#taskTable tbody tr").forEach(row => {
      const p = row.cells[1].textContent.toLowerCase();
      const o = row.cells[2].textContent.toLowerCase();
      const s = row.cells[3].textContent.toLowerCase();
      row.style.display = 
        (priorityVal === "all" || p === priorityVal) &&
        (ownerVal === "all" || o === ownerVal) &&
        (statusVal === "all" || s === statusVal)
        ? "" : "none";
    });
  }

  loadTasks();
</script>

</body>
</html>

